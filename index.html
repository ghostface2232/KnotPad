<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KnotPad</title>
    <meta name="theme-color" content="#09090b">
    <meta name="description" content="Infinite canvas for notes, links, and ideas">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="KnotPad">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icons/icon-512.png">
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">Canvas</span>
            <div class="sidebar-header-actions">
                <button class="sidebar-pin-btn" id="sidebarPinBtn" title="Pin Sidebar">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 17v5M9 10.76a2 2 0 01-1.11 1.79l-1.78.9A2 2 0 005 15.24V16a1 1 0 001 1h12a1 1 0 001-1v-.76a2 2 0 00-1.11-1.79l-1.78-.9A2 2 0 0115 10.76V5a1 1 0 011-1 1 1 0 001-1V2a1 1 0 00-1-1H8a1 1 0 00-1 1v1a1 1 0 001 1 1 1 0 011 1z"/></svg>
                </button>
                <button class="sidebar-add" id="addCanvasBtn" title="New Canvas">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14" stroke-linecap="round"/></svg>
                </button>
            </div>
        </div>
        <div class="canvas-list" id="canvasList"></div>
        <div class="sidebar-footer">
            <button class="sidebar-settings-btn" id="settingsBtn" title="Settings">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                <span>Settings</span>
            </button>
        </div>
        <div class="canvas-icon-picker" id="canvasIconPicker">
            <div class="icon-opt none" data-icon="" title="Text">Aa</div>
            <div class="icon-opt" data-icon="canvas" title="Canvas"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18M3 9h6"/></svg></div>
            <div class="icon-opt" data-icon="music" title="Music"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg></div>
            <div class="icon-opt" data-icon="image" title="Image"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg></div>
            <div class="icon-opt" data-icon="document" title="Document"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg></div>
            <div class="icon-opt" data-icon="chat" title="Chat"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></div>
            <div class="icon-opt" data-icon="chart" title="Chart"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg></div>
            <div class="icon-opt" data-icon="code" title="Code"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/></svg></div>
            <div class="icon-opt" data-icon="bookmark" title="Bookmark"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg></div>
            <div class="icon-opt" data-icon="star" title="Star"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></div>
            <div class="icon-opt" data-icon="heart" title="Heart"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg></div>
            <div class="icon-opt" data-icon="folder" title="Folder"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg></div>
        </div>
    </div>

    <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Sidebar">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18" stroke-linecap="round"/></svg>
    </button>

    <div id="app" tabindex="0">
        <div id="canvas">
            <div class="grid-overlay"></div>
            <svg id="connectionsSvg"></svg>
        </div>
        <div id="selectionBox"></div>
    </div>

    <div class="search-bar" id="searchBar">
        <svg width="16" height="16" viewBox="0 0 45 45" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.71.01C31.62.28 40.38 9.21 40.38 20.19l-.01.52c-.11 4.31-1.57 8.29-3.98 11.52l7.43 7.43a3.1 3.1 0 01-4.38 4.38l-7.47-7.46a20.1 20.1 0 01-11.79 3.8l-.52-.01C8.93 40.1.28 31.45.01 20.71L0 20.19C0 9.04 9.04 0 20.19 0l.52.01zM20.19 6.2c-7.73 0-13.99 6.26-13.99 13.99 0 7.73 6.26 13.99 13.99 13.99 7.73 0 13.99-6.26 13.99-13.99 0-7.73-6.26-13.99-13.99-13.99z"/></svg>
        <input type="text" id="searchInput" placeholder="Search nodes...">
        <div class="search-nav">
            <button id="searchPrev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg></button>
            <span id="searchCount">0/0</span>
            <button id="searchNext"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></button>
        </div>
        <button class="search-close" id="searchClose"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    </div>

    <div class="drop-overlay" id="dropZone">
        <div class="drop-content">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 16V4m0 0L8 8m4-4l4 4M3 15v4a2 2 0 002 2h14a2 2 0 002-2v-4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h3>Drop to add</h3>
            <p>Images, videos, or links</p>
        </div>
    </div>

    <input type="file" id="fileInput" multiple accept="image/*,video/*">

    <div class="toolbar">
        <button class="toolbar-btn" id="addMemoBtn" title="Add Memo"><svg width="18" height="18" viewBox="0 0 46 58" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M24.26 0h-13.06C7.28 0 5.32 0 3.82.76A5.76 5.76 0 00.76 3.82C0 5.32 0 7.28 0 11.2v34.63c0 3.92 0 5.88.76 7.38a5.76 5.76 0 003.06 3.06c1.5.76 3.46.76 7.38.76h23.39c3.92 0 5.88 0 7.38-.76a5.76 5.76 0 003.06-3.06c.76-1.5.76-3.46.76-7.38V21.72c0-.7 0-1.19-.06-1.56-.06-.68-.35-1.34-.87-1.85L27.45.89a3.48 3.48 0 00-1.34-.77 8.3 8.3 0 00-1.85-.12zM11.2 6c-2.06 0-3.24 0-4.11.08-.34.03-.53.06-.62.08a.76.76 0 00-.32.32c-.02.09-.05.28-.08.62-.07.87-.07 2.05-.07 4.1v34.63c0 2.06 0 3.24.07 4.11.03.34.06.53.08.62a.76.76 0 00.32.32c.09.02.28.05.62.08.87.07 2.05.08 4.11.08h23.39c2.06 0 3.24-.01 4.11-.08.34-.03.53-.06.62-.08a.76.76 0 00.32-.32c.02-.09.05-.28.08-.62.05-.65.07-1.48.07-2.72V24.52h-9.14c-.46 0-1.17 0-1.8-.05-.71-.06-1.83-.21-3.03-.83a5.76 5.76 0 01-2.5-2.5c-.62-1.2-.77-2.32-.83-3.03-.05-.63-.05-1.34-.05-1.8V6H11.2zm16.26 9.32c0 1.12 0 1.68.22 2.11.19.38.5.68.87.87.32.16.72.2 1.37.21l.74.01h5.94l-9.14-9.14v5.94z"/><path d="M32.6 28.48a3.5 3.5 0 010 7H13.2a3.5 3.5 0 010-7h19.4zM32.6 39.11a3.5 3.5 0 010 7H13.2a3.5 3.5 0 010-7h19.4z"/></svg></button>
        <button class="toolbar-btn" id="addLinkBtn" title="Add Link"><svg width="18" height="18" viewBox="0 0 53 53" fill="currentColor"><path d="M22.41 15.79c3.87 0 7.52 1.51 10.26 4.25l.12.13a3.1 3.1 0 01-.12 4.6 3.1 3.1 0 01-4.61-.12 8.49 8.49 0 00-11.07 0l-7.9 7.9a8.5 8.5 0 000 11.07l.29.28a8.5 8.5 0 0010.78 0l3.58-3.58a3.1 3.1 0 014.73 4.73l-3.95 3.95a14.7 14.7 0 01-20.33 0 14.7 14.7 0 010-20.53l7.9-7.9a14.69 14.69 0 0110.32-4.78zm5.53-11.55a14.7 14.7 0 0120.53 0l.26.27a14.7 14.7 0 010 20.26l-7.9 7.9a14.7 14.7 0 01-20.53 0 3.1 3.1 0 014.73-4.73 8.49 8.49 0 0011.07 0l7.9-7.9a8.5 8.5 0 000-11.07 8.5 8.5 0 00-11.07 0l-3.95 3.95a3.1 3.1 0 01-4.73-4.73l3.95-3.95h.01z"/></svg></button>
        <button class="toolbar-btn" id="addFileBtn" title="Add Image/Video"><svg width="18" height="18" viewBox="0 0 51 51" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.2 8.24a7.7 7.7 0 110 15.41 7.7 7.7 0 010-15.41zm0 5.5a2.2 2.2 0 100 4.41 2.2 2.2 0 000-4.41z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M40.4 0c3.4 0 5.1 0 6.4.66a6.28 6.28 0 012.66 2.66c.66 1.3.66 3 .66 6.4v30.68c0 3.4 0 5.1-.66 6.4a6.28 6.28 0 01-2.66 2.66c-1.3.66-3 .66-6.4.66H9.72c-3.4 0-5.1 0-6.4-.66a6.28 6.28 0 01-2.66-2.66C0 45.51 0 43.81 0 40.4V9.72c0-3.4 0-5.1.66-6.4A6.28 6.28 0 013.32.66C4.62 0 6.32 0 9.72 0h30.68zM32.83 23.77c-.06 0-.3.02-1 .54-.74.56-1.66 1.41-3.13 2.8L10.89 43.85h29.51c1.73 0 2.7-.01 3.39-.06.05-.69.06-1.66.06-3.39v-6.51l-6.56-6.63c-1.42-1.44-2.31-2.32-3.04-2.91-.68-.54-.91-.57-.97-.58-.15-.02-.3-.02-.45 0zM9.72 6.28c-1.73 0-2.7 0-3.39.06-.05.69-.06 1.66-.06 3.38v29.96l17.77-17.09c1.37-1.28 2.58-2.43 3.68-3.25 1.15-.86 2.46-1.59 4.1-1.75.62-.06 1.25-.05 1.87.03 1.63.22 2.92 1 4.04 1.89 1.06.86 2.23 2.05 3.55 3.38l2.16 2.18V9.72c0-1.73-.01-2.7-.06-3.38-.69-.05-1.66-.06-3.39-.06H9.72z"/></svg></button>
        <div class="toolbar-sep"></div>
        <button class="toolbar-btn" id="colorBtn" title="Set Color"><svg width="18" height="18" viewBox="0 0 56 49" fill="currentColor"><path d="M13.86 19.1a3.9 3.9 0 110 7.8 3.9 3.9 0 010-7.8zM41.46 16a3.9 3.9 0 110 7.8 3.9 3.9 0 010-7.8zM21.37 10.67a3.9 3.9 0 110 7.8 3.9 3.9 0 010-7.8zM32.21 10.11a3.9 3.9 0 110 7.8 3.9 3.9 0 010-7.8z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M26.91 0c15 0 28.55 9.14 28.55 23.32 0 4.6-1.02 8.17-3.21 10.67-2.22 2.53-5.2 3.43-7.97 3.66-2.72.23-5.58-.17-7.97-.55-2.59-.41-4.5-.77-5.97-.77-2.14 0-2.42.57-2.42.58-.23.33-.38.98-.48 2.66-.04.7-.08 1.63-.2 2.51-.12.89-.36 1.98-.91 3.01-.59 1.1-1.49 2.07-2.78 2.71-1.23.62-2.64.86-4.15.86-6.07 0-11.07-2.28-14.49-6.52C1.57 37.99 0 32.29 0 25.82 0 12.07 11.16 0 26.91 0zm0 6.2c-12.35 0-20.71 9.32-20.71 19.62 0 5.55 1.36 9.72 3.55 12.44 2.12 2.63 5.27 4.22 9.68 4.22.88 0 1.26-.15 1.37-.2.06-.03.06-.03.09-.08.06-.12.15-.39.23-.94.08-.57.1-1.18.15-2.02.08-1.4.2-3.83 1.55-5.81 1.59-2.31 4.23-3.27 7.54-3.27 2.1 0 4.73.5 6.94.85 2.4.38 4.6.65 6.5.5 1.84-.15 3.03-.67 3.82-1.57.82-.93 1.67-2.79 1.67-6.62 0-9.4-9.24-17.12-22.35-17.12z"/></svg></button>
        <button class="toolbar-btn" id="filterBtn" title="Filter by Color"><svg width="18" height="18" viewBox="0 0 53 36" fill="currentColor"><path d="M32.58 29.18a3.1 3.1 0 010 6.2H19.65a3.1 3.1 0 010-6.2h12.93zM40.45 14.31a3.1 3.1 0 010 6.2H11.79a3.1 3.1 0 010-6.2h28.66zM49.14 0a3.1 3.1 0 010 6.2H3.1a3.1 3.1 0 010-6.2h46.04z"/></svg></button>
        <button class="toolbar-btn" id="sortByColorBtn" title="Sort by Color"><svg width="18" height="18" viewBox="0 0 46 47" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.58 24.17c2.59.01 4.02.08 5.14.65a5.76 5.76 0 012.62 2.62c.65 1.28.65 2.96.65 6.32v3.98c-.01 2.59-.08 4.02-.65 5.14a5.76 5.76 0 01-2.62 2.62c-1.12.59-2.55.66-5.14.68H9.6c-3.15 0-4.82 0-6.08-.54a5.76 5.76 0 01-2.76-2.76C.22 41.77.17 40.34.08 37.75L0 33.77c0-3.36 0-5.04.65-6.32a5.76 5.76 0 012.63-2.62c1.28-.65 2.96-.65 6.32-.65h3.98zm-3.98 6.2c-1.71 0-2.66 0-3.35.05-.05.68-.05 1.64-.05 3.35v2.8c0 1.7 0 2.66.05 3.34.68.05 1.64.06 3.35.06h2.8c1.7 0 2.66-.01 3.34-.06.05-.68.06-1.64.06-3.34v-2.8c0-1.71-.01-2.67-.06-3.35-.68-.05-1.64-.05-3.34-.05H9.6zm28 -6.2c2.59.01 4.02.08 5.14.65a5.76 5.76 0 012.62 2.62c.65 1.28.65 2.96.65 6.32v3.98c-.01 2.59-.08 4.02-.65 5.14a5.76 5.76 0 01-2.62 2.62c-1.12.59-2.55.66-5.14.68H33.6c-3.15 0-4.82 0-6.08-.54a5.76 5.76 0 01-2.76-2.76c-.54-1.11-.59-2.54-.68-5.13L24 33.77c0-3.36 0-5.04.65-6.32a5.76 5.76 0 012.63-2.62c1.28-.65 2.96-.65 6.32-.65h3.98zm-3.98 6.2c-1.7 0-2.66 0-3.34.05-.05.68-.06 1.64-.06 3.35v2.8c0 1.7.01 2.66.06 3.34.68.05 1.64.06 3.34.06h2.8c1.71 0 2.67-.01 3.35-.06.05-.68.05-1.64.05-3.34v-2.8c0-1.71 0-2.67-.05-3.35-.68-.05-1.64-.05-3.35-.05h-2.8zm-20.04-30c2.59.01 4.02.08 5.14.65a5.76 5.76 0 012.62 2.63C22 4.93 22 6.61 22 9.97v3.98c-.01 2.59-.08 4.02-.65 5.14a5.76 5.76 0 01-2.62 2.62c-1.12.59-2.55.66-5.14.68H9.6c-3.15 0-4.82 0-6.08-.54a5.76 5.76 0 01-2.76-2.76C.22 17.98.17 16.55.08 13.96L0 9.97c0-3.36 0-5.04.65-6.32a5.76 5.76 0 012.63-2.63C4.56 0 6.24 0 9.6 0h3.98zM9.6 6.2c-1.71 0-2.66.01-3.35.06-.05.68-.05 1.64-.05 3.34v2.8c0 1.71 0 2.67.05 3.35.68.05 1.64.05 3.35.05h2.8c1.7 0 2.66 0 3.34-.05.05-.68.06-1.64.06-3.35V9.6c0-1.7-.01-2.66-.06-3.34-.68-.05-1.64-.06-3.34-.06H9.6zm28 0c-1.7 0-2.66.01-3.34.06-.06.68-.06 1.64-.06 3.34v2.8c0 1.71 0 2.67.06 3.35.68.05 1.64.05 3.34.05h2.8c1.71 0 2.67 0 3.35-.05.05-.68.05-1.64.05-3.35V9.6c0-1.7 0-2.66-.05-3.34-.68-.06-1.64-.06-3.35-.06h-2.8z"/></svg></button>
        <div class="toolbar-sep"></div>
        <button class="toolbar-btn" id="zoomOutBtn" title="Zoom Out"><svg width="18" height="18" viewBox="0 0 45 45" fill="currentColor"><path d="M27.49 17.69a2.5 2.5 0 010 5H12.9a2.5 2.5 0 010-5h14.59z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.71.01C31.62.28 40.38 9.21 40.38 20.19l-.01.52c-.11 4.31-1.57 8.29-3.98 11.52l7.43 7.43a3.1 3.1 0 01-4.38 4.38l-7.47-7.46a20.1 20.1 0 01-11.79 3.8l-.52-.01C8.93 40.1.28 31.45.01 20.71L0 20.19C0 9.04 9.04 0 20.19 0l.52.01zM20.19 6.2c-7.73 0-13.99 6.26-13.99 13.99 0 7.73 6.26 13.99 13.99 13.99 7.73 0 13.99-6.26 13.99-13.99 0-7.73-6.26-13.99-13.99-13.99z"/></svg></button>
        <div class="zoom-display" id="zoomDisplay">100%</div>
        <button class="toolbar-btn" id="zoomInBtn" title="Zoom In"><svg width="18" height="18" viewBox="0 0 45 45" fill="currentColor"><path d="M20.19 10.4a2.5 2.5 0 012.5 2.5v4.79h4.8a2.5 2.5 0 010 5h-4.8v4.8a2.5 2.5 0 01-5 0v-4.8h-4.8a2.5 2.5 0 010-5h4.8v-4.8a2.5 2.5 0 012.5-2.5z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.71.01C31.62.28 40.38 9.21 40.38 20.19l-.01.52c-.11 4.31-1.57 8.29-3.98 11.52l7.43 7.43a3.1 3.1 0 01-4.38 4.38l-7.46-7.46a20.1 20.1 0 01-11.79 3.8l-.52-.01C8.93 40.1.28 31.45.01 20.71L0 20.19C0 9.04 9.04 0 20.19 0l.52.01zM20.19 6.2c-7.73 0-13.99 6.26-13.99 13.99 0 7.73 6.26 13.99 13.99 13.99 7.73 0 13.99-6.26 13.99-13.99 0-7.73-6.26-13.99-13.99-13.99z"/></svg></button>
        <button class="toolbar-btn" id="fitViewBtn" title="Fit to Screen"><svg width="18" height="18" viewBox="0 0 45 45" fill="currentColor"><path d="M2.99 26a2.99 2.99 0 012.99 2.98v3.28c0 1.67 0 2.74.07 3.56.07.78.18 1.06.24 1.18.27.53.7.96 1.22 1.22.13.07.4.17 1.19.24.81.07 1.88.07 3.55.07h3.28a2.99 2.99 0 010 5.98h-3.28c-1.57 0-2.89 0-4 -.09-1.15-.1-2.3-.3-3.41-.87a6.97 6.97 0 01-3.05-3.05c-.57-1.1-.78-2.26-.87-3.41-.09-1.11-.09-2.43-.09-4v-3.28A2.99 2.99 0 012.99 26zm38.36 0a2.99 2.99 0 012.99 2.98v3.28c0 1.57 0 2.89-.09 4-.1 1.15-.3 2.3-.87 3.41a6.97 6.97 0 01-3.05 3.05c-1.1.57-2.26.77-3.41.87-1.11.09-2.43.09-4 .09h-3.28a2.99 2.99 0 010-5.98h3.28c1.67 0 2.74 0 3.55-.07.78-.07 1.06-.17 1.19-.24a2.99 2.99 0 001.22-1.22c.06-.12.17-.4.24-1.18.07-.82.07-1.89.07-3.56v-3.28A2.99 2.99 0 0141.35 26zM15.52 0a2.99 2.99 0 010 5.98h-3.28c-1.67 0-2.74 0-3.55.07-.79.07-1.06.17-1.19.24a2.99 2.99 0 00-1.22 1.22c-.06.13-.17.4-.24 1.19-.07.81-.07 1.88-.07 3.55v3.28a2.99 2.99 0 01-5.98 0v-3.28c0-1.57 0-2.89.09-4 .09-1.15.3-2.3.87-3.41A6.97 6.97 0 014 .79C5.11.22 6.27.01 7.42-.08c1.11-.09 2.43-.09 4-.09h3.28V0h.82zm16.58 0c1.57 0 2.89 0 4 .09 1.15.09 2.3.3 3.41.87a6.97 6.97 0 013.05 3.05c.57 1.1.78 2.26.87 3.41.09 1.11.09 2.43.09 4v3.28a2.99 2.99 0 01-5.98 0v-3.28c0-1.67 0-2.74-.07-3.55-.07-.79-.18-1.06-.24-1.19a2.99 2.99 0 00-1.22-1.22c-.13-.07-.4-.17-1.19-.24-.81-.07-1.88-.07-3.55-.07h-3.28a2.99 2.99 0 010-5.98h3.28l.83-.17z"/></svg></button>
    </div>

    <div class="color-dropdown" id="colorDropdown">
        <div class="color-opt none" data-color="" title="None"></div>
        <div class="color-opt" data-color="red" style="background:var(--tag-red)" title="Red"></div>
        <div class="color-opt" data-color="orange" style="background:var(--tag-orange)" title="Orange"></div>
        <div class="color-opt" data-color="yellow" style="background:var(--tag-yellow)" title="Yellow"></div>
        <div class="color-opt" data-color="green" style="background:var(--tag-green)" title="Green"></div>
        <div class="color-opt" data-color="blue" style="background:var(--tag-blue)" title="Blue"></div>
        <div class="color-opt" data-color="purple" style="background:var(--tag-purple)" title="Purple"></div>
        <div class="color-opt" data-color="pink" style="background:var(--tag-pink)" title="Pink"></div>
    </div>

    <div class="filter-dropdown" id="filterDropdown">
        <div class="filter-opt all" data-color="all" title="Show All"></div>
        <div class="filter-opt none" data-color="none" title="No Color"></div>
        <div class="filter-opt" data-color="red" style="background:var(--tag-red)" title="Red"></div>
        <div class="filter-opt" data-color="orange" style="background:var(--tag-orange)" title="Orange"></div>
        <div class="filter-opt" data-color="yellow" style="background:var(--tag-yellow)" title="Yellow"></div>
        <div class="filter-opt" data-color="green" style="background:var(--tag-green)" title="Green"></div>
        <div class="filter-opt" data-color="blue" style="background:var(--tag-blue)" title="Blue"></div>
        <div class="filter-opt" data-color="purple" style="background:var(--tag-purple)" title="Purple"></div>
        <div class="filter-opt" data-color="pink" style="background:var(--tag-pink)" title="Pink"></div>
    </div>

    <div class="conn-direction-picker" id="connDirectionPicker">
        <button data-dir="none" title="No direction">â€•</button>
        <button data-dir="forward" title="Forward"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
        <button data-dir="backward" title="Backward"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button>
        <button data-dir="both" title="Both ways"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 17l-5-5 5-5M17 7l5 5-5 5M2 12h20"/></svg></button>
        <button class="conn-delete-btn" data-action="delete" title="Delete connection"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    </div>


    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-action="duplicate"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>Duplicate</div>
        <div class="context-menu-sep"></div>
        <div class="context-menu-item" data-action="lock"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>Lock to Back</div>
        <div class="context-menu-sep"></div>
        <div class="context-menu-item danger" data-action="delete"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg>Delete</div>
    </div>

    <div class="context-menu" id="connectionContextMenu">
        <div class="context-menu-item danger" data-action="delete"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg>Delete</div>
    </div>

    <div class="context-menu" id="canvasContextMenu">
        <div class="context-menu-item" data-action="new-memo"><svg width="14" height="14" viewBox="0 0 46 58" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M24.26 0h-13.06C7.28 0 5.32 0 3.82.76A5.76 5.76 0 00.76 3.82C0 5.32 0 7.28 0 11.2v34.63c0 3.92 0 5.88.76 7.38a5.76 5.76 0 003.06 3.06c1.5.76 3.46.76 7.38.76h23.39c3.92 0 5.88 0 7.38-.76a5.76 5.76 0 003.06-3.06c.76-1.5.76-3.46.76-7.38V21.72c0-.7 0-1.19-.06-1.56-.06-.68-.35-1.34-.87-1.85L27.45.89a3.48 3.48 0 00-1.34-.77 8.3 8.3 0 00-1.85-.12zM11.2 6c-2.06 0-3.24 0-4.11.08-.34.03-.53.06-.62.08a.76.76 0 00-.32.32c-.02.09-.05.28-.08.62-.07.87-.07 2.05-.07 4.1v34.63c0 2.06 0 3.24.07 4.11.03.34.06.53.08.62a.76.76 0 00.32.32c.09.02.28.05.62.08.87.07 2.05.08 4.11.08h23.39c2.06 0 3.24-.01 4.11-.08.34-.03.53-.06.62-.08a.76.76 0 00.32-.32c.02-.09.05-.28.08-.62.05-.65.07-1.48.07-2.72V24.52h-9.14c-.46 0-1.17 0-1.8-.05-.71-.06-1.83-.21-3.03-.83a5.76 5.76 0 01-2.5-2.5c-.62-1.2-.77-2.32-.83-3.03-.05-.63-.05-1.34-.05-1.8V6H11.2zm16.26 9.32c0 1.12 0 1.68.22 2.11.19.38.5.68.87.87.32.16.72.2 1.37.21l.74.01h5.94l-9.14-9.14v5.94z"/><path d="M32.6 28.48a3.5 3.5 0 010 7H13.2a3.5 3.5 0 010-7h19.4zM32.6 39.11a3.5 3.5 0 010 7H13.2a3.5 3.5 0 010-7h19.4z"/></svg>New Memo</div>
        <div class="context-menu-item" data-action="new-link"><svg width="14" height="14" viewBox="0 0 53 53" fill="currentColor"><path d="M22.41 15.79c3.87 0 7.52 1.51 10.26 4.25l.12.13a3.1 3.1 0 01-.12 4.6 3.1 3.1 0 01-4.61-.12 8.49 8.49 0 00-11.07 0l-7.9 7.9a8.5 8.5 0 000 11.07l.29.28a8.5 8.5 0 0010.78 0l3.58-3.58a3.1 3.1 0 014.73 4.73l-3.95 3.95a14.7 14.7 0 01-20.33 0 14.7 14.7 0 010-20.53l7.9-7.9a14.69 14.69 0 0110.32-4.78zm5.53-11.55a14.7 14.7 0 0120.53 0l.26.27a14.7 14.7 0 010 20.26l-7.9 7.9a14.7 14.7 0 01-20.53 0 3.1 3.1 0 014.73-4.73 8.49 8.49 0 0011.07 0l7.9-7.9a8.5 8.5 0 000-11.07 8.5 8.5 0 00-11.07 0l-3.95 3.95a3.1 3.1 0 01-4.73-4.73l3.95-3.95h.01z"/></svg>New Link</div>
        <div class="context-menu-item" data-action="new-image"><svg width="14" height="14" viewBox="0 0 51 51" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.2 8.24a7.7 7.7 0 110 15.41 7.7 7.7 0 010-15.41zm0 5.5a2.2 2.2 0 100 4.41 2.2 2.2 0 000-4.41z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M40.4 0c3.4 0 5.1 0 6.4.66a6.28 6.28 0 012.66 2.66c.66 1.3.66 3 .66 6.4v30.68c0 3.4 0 5.1-.66 6.4a6.28 6.28 0 01-2.66 2.66c-1.3.66-3 .66-6.4.66H9.72c-3.4 0-5.1 0-6.4-.66a6.28 6.28 0 01-2.66-2.66C0 45.51 0 43.81 0 40.4V9.72c0-3.4 0-5.1.66-6.4A6.28 6.28 0 013.32.66C4.62 0 6.32 0 9.72 0h30.68zM32.83 23.77c-.06 0-.3.02-1 .54-.74.56-1.66 1.41-3.13 2.8L10.89 43.85h29.51c1.73 0 2.7-.01 3.39-.06.05-.69.06-1.66.06-3.39v-6.51l-6.56-6.63c-1.42-1.44-2.31-2.32-3.04-2.91-.68-.54-.91-.57-.97-.58-.15-.02-.3-.02-.45 0zM9.72 6.28c-1.73 0-2.7 0-3.39.06-.05.69-.06 1.66-.06 3.38v29.96l17.77-17.09c1.37-1.28 2.58-2.43 3.68-3.25 1.15-.86 2.46-1.59 4.1-1.75.62-.06 1.25-.05 1.87.03 1.63.22 2.92 1 4.04 1.89 1.06.86 2.23 2.05 3.55 3.38l2.16 2.18V9.72c0-1.73-.01-2.7-.06-3.38-.69-.05-1.66-.06-3.39-.06H9.72z"/></svg>New Image/Video</div>
        <div class="context-menu-sep"></div>
        <div class="context-menu-item" data-action="grid-snap"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span>Grid Snap</span><span class="context-menu-check" id="gridSnapCheck"></span></div>
        <div class="context-menu-item" data-action="invert-zoom"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35M11 8v6M8 11h6"/></svg><span>Invert Wheel Zoom</span><span class="context-menu-check" id="invertZoomCheck"></span></div>
    </div>

    <div class="modal" id="linkModal">
        <div class="modal-box">
            <h3>Add Link</h3>
            <input type="text" class="modal-input" id="linkTitle" placeholder="Title (optional)">
            <input type="url" class="modal-input" id="linkUrl" placeholder="https://example.com">
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" data-close>Cancel</button>
                <button class="modal-btn modal-btn-submit" id="linkSubmit">Add</button>
            </div>
        </div>
    </div>

    <input type="file" id="importInput" accept=".json" style="display:none">

    <div class="topbar" id="topbar">
        <div class="topbar-group">
            <span class="topbar-canvas-name" id="topbarCanvasName">Untitled</span>
            <div class="topbar-sep"></div>
            <button class="topbar-btn" id="undoBtn" title="Undo (Ctrl+Z)"><svg width="18" height="18" viewBox="0 0 43 41" fill="currentColor"><path d="M12.11.91a3.1 3.1 0 014.38 4.38L10.58 11.2h17.23c8.02 0 14.52 6.5 14.52 14.52 0 8.02-6.5 14.52-14.52 14.52h-5.39a3.1 3.1 0 010-6.2h5.39c4.6 0 8.32-3.73 8.32-8.32 0-4.6-3.73-8.32-8.32-8.32H10.36l6.13 6.13a3.1 3.1 0 01-4.38 4.38L.91 16.72a3.14 3.14 0 01-.77-2.28c0-.05 0-.1.01-.14 0-.3.04-.58.12-.85l.03-.1c.02-.07.04-.13.07-.2.06-.17.13-.33.24-.49.02-.05.05-.1.1-.14.02-.03.03-.05.04-.07.14-.25.31-.49.52-.7L12.11.91z"/></svg></button>
            <button class="topbar-btn" id="redoBtn" title="Redo (Ctrl+Y)"><svg width="18" height="18" viewBox="0 0 43 41" fill="currentColor"><path d="M25.84.91a3.1 3.1 0 014.38 0L41.42 12.1c.21.21.39.45.52.7l.04.08c.04.05.07.09.1.14.1.16.18.32.24.49l.06.2.03.1c.08.27.12.55.12.85v.14c0 .81-.31 1.62-.9 2.28L30.22 27.91a3.1 3.1 0 01-4.38-4.38l6.13-6.13H14.52c-4.6 0-8.32 3.73-8.32 8.32 0 4.6 3.72 8.32 8.32 8.32h5.39a3.1 3.1 0 010 6.2h-5.39C6.5 40.24 0 33.74 0 25.72c0-8.02 6.5-14.52 14.52-14.52h17.23l-5.91-5.91a3.1 3.1 0 010-4.38z"/></svg></button>
            <div class="topbar-sep"></div>
            <button class="topbar-btn" id="importBtn" title="Import"><svg width="18" height="18" viewBox="0 0 45 46" fill="currentColor"><path d="M41.23 25.64a3.1 3.1 0 013.1 3.1v4.11c0 1.63 0 3.07-.1 4.22-.11 1.19-.34 2.39-.91 3.54a9.1 9.1 0 01-3.97 3.98c-1.15.56-2.36.8-3.55.9-1.15.1-2.59.1-4.22.1H12.7c-1.63 0-3.07 0-4.22-.1-1.19-.1-2.4-.34-3.54-.9a9.1 9.1 0 01-3.98-3.98c-.56-1.15-.8-2.35-.9-3.54-.1-1.15-.1-2.59-.1-4.22v-4.11a3.1 3.1 0 016.2 0v4.11c0 1.73 0 2.87.07 3.73.07.81.18 1.1.26 1.23.27.54.7.98 1.24 1.25.13.07.41.18 1.23.26.86.07 2 .07 3.73.07h18.93c1.73 0 2.87 0 3.73-.07.81-.08 1.1-.19 1.23-.26.54-.27.98-.71 1.25-1.25.07-.13.17-.42.25-1.23.07-.86.07-2 .07-3.73v-4.11a3.1 3.1 0 013.1-3.1z"/><path d="M22.2 0h.24c.08 0 .15.01.23.01l.11.01.12.01c.08 0 .17.01.25.04l.08.02.08.02c.08.02.16.04.23.07l.08.03.08.04c.33.15.64.36.92.62l9.44 9.44a3.1 3.1 0 01-4.38 4.38l-4.15-4.15v16.64a3.1 3.1 0 01-6.2 0V10.54l-4.15 4.15a3.1 3.1 0 11-4.38-4.38l9.44-9.44c.27-.27.57-.47.87-.62l.08-.03.08-.04c.06-.03.13-.05.2-.07l.08-.02.09-.02a3 3 0 01.23-.05l.11-.01h.11a2.7 2.7 0 01.24-.01h.04z"/></svg></button>
            <button class="topbar-btn" id="exportBtn" title="Export"><svg width="18" height="18" viewBox="0 0 45 47" fill="currentColor"><path d="M41.23 26.62a3.1 3.1 0 013.1 3.1v4.11c0 1.63 0 3.07-.1 4.22-.11 1.19-.34 2.39-.91 3.54a9.1 9.1 0 01-3.97 3.98c-1.15.56-2.36.8-3.55.9-1.15.1-2.59.1-4.22.1H12.7c-1.63 0-3.07 0-4.22-.1-1.19-.1-2.4-.34-3.54-.9a9.1 9.1 0 01-3.98-3.98c-.56-1.15-.8-2.35-.9-3.54-.1-1.15-.1-2.59-.1-4.22v-4.11a3.1 3.1 0 016.2 0v4.11c0 1.73 0 2.87.07 3.73.07.81.18 1.1.26 1.23.27.54.7.98 1.24 1.25.13.07.41.18 1.23.26.86.07 2 .07 3.73.07h18.93c1.73 0 2.87 0 3.73-.07.81-.08 1.1-.19 1.23-.26.54-.27.98-.71 1.25-1.25.07-.13.17-.42.25-1.23.07-.86.07-2 .07-3.73v-4.11a3.1 3.1 0 013.1-3.1z"/><path d="M22.16 0a3.1 3.1 0 013.1 3.1v16.64l4.15-4.15a3.1 3.1 0 014.38 4.38l-9.44 9.44c-.27.27-.56.48-.87.62l-.08.04-.08.03c-.06.03-.13.05-.2.07l-.08.02-.09.02a3 3 0 01-.23.05l-.1.01H22.5c-.09.01-.17.02-.25.02l-.1-.01h-.13c-.08-.01-.16-.02-.24-.04l-.08-.02-.08-.02a2.57 2.57 0 01-.23-.07l-.09-.03-.08-.04a3.1 3.1 0 01-.91-.62l-9.44-9.44a3.1 3.1 0 014.38-4.38l4.15 4.15V3.1a3.1 3.1 0 013.1-3.1h-.24z"/></svg></button>
            <div class="topbar-sep"></div>
            <button class="topbar-btn" id="themeToggle" title="Theme">
                <svg class="moon" width="18" height="18" viewBox="0 0 48 48" fill="currentColor"><path d="M18.74.07c1.17-.26 2.39.25 2.87 1.2.74.95.86 2.29.43 4.44C18.45 11.81 19.18 19.43 23.63 23.88c4.45 4.44 12.05 5.18 18.35 1.47 2.15-.43 3.49-.31 4.44.43.95.48 1.46 1.7 1.2 2.87C45.07 39.32 35.76 47.26 24.54 47.5c-13.26 0-24.01-10.75-24.01-24.01C.53 12.05 8.01 2.47 18.74.07zM6.21 23.96c.24 9.62 7.88 17.35 17.79 17.35 6.19 0 11.65-3.17 14.84-7.97-7.14 1.53-14.33.15-19.6-5.12-5.27-5.27-6.65-12.46-5.12-19.6-4.8 3.19-7.97 8.65-7.97 14.84l.06.5z"/></svg>
                <svg class="sun" width="18" height="18" viewBox="0 0 54 54" fill="currentColor" style="display:none"><path d="M26.58 44.97a3.1 3.1 0 013.1 3.1v2a3.1 3.1 0 01-6.2 0v-2a3.1 3.1 0 013.1-3.1zM9.21 39.59a3.1 3.1 0 014.38 4.38l-1.42 1.41a3.1 3.1 0 01-4.38-4.38l1.42-1.41zm30.38 0l1.41 1.41a3.1 3.1 0 01-4.38 4.38l-1.41-1.41a3.1 3.1 0 014.38-4.38z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M26.58 10.47c8.91 0 16.11 7.21 16.11 16.11s-7.2 16.12-16.11 16.12-16.11-7.21-16.11-16.12c0-8.9 7.2-16.11 16.11-16.11zm0 6.2c-5.47 0-9.91 4.44-9.91 9.91 0 5.48 4.44 9.92 9.91 9.92 5.48 0 9.91-4.44 9.91-9.92 0-5.47-4.43-9.91-9.91-9.91z"/><path d="M5.1 23.49a3.1 3.1 0 010 6.2H3.1a3.1 3.1 0 010-6.2h2zm45 0a3.1 3.1 0 010 6.2h-2a3.1 3.1 0 010-6.2h2zM7.78 7.79a3.1 3.1 0 014.38 0l1.42 1.42a3.1 3.1 0 11-4.38 4.38L7.78 12.17a3.1 3.1 0 010-4.38zm33.22 0a3.1 3.1 0 014.38 4.38l-1.41 1.42a3.1 3.1 0 01-4.38-4.38l1.41-1.42zM26.58 0a3.1 3.1 0 013.1 3.1v2a3.1 3.1 0 01-6.2 0v-2a3.1 3.1 0 013.1-3.1z"/></svg>
            </button>
            <div class="topbar-sep"></div>
            <button class="topbar-btn" id="searchBtn" title="Search (Ctrl+F)">
                <svg width="18" height="18" viewBox="0 0 45 45" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.71.01C31.62.28 40.38 9.21 40.38 20.19l-.01.52c-.11 4.31-1.57 8.29-3.98 11.52l7.43 7.43a3.1 3.1 0 01-4.38 4.38l-7.47-7.46a20.1 20.1 0 01-11.79 3.8l-.52-.01C8.93 40.1.28 31.45.01 20.71L0 20.19C0 9.04 9.04 0 20.19 0l.52.01zM20.19 6.2c-7.73 0-13.99 6.26-13.99 13.99 0 7.73 6.26 13.99 13.99 13.99 7.73 0 13.99-6.26 13.99-13.99 0-7.73-6.26-13.99-13.99-13.99z"/></svg>
            </button>
        </div>
    </div>
    <div class="minimap" id="minimap"><div class="minimap-content" id="minimapContent"></div></div>
    <div class="toast" id="toast"></div>

    <div class="modal" id="settingsModal">
        <div class="modal-box settings-modal-box">
            <div class="settings-header">
                <h3>Settings</h3>
                <button class="settings-close-btn" data-close>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="settings-tabs">
                <button class="settings-tab active" data-tab="storage">
                    <svg width="16" height="16" viewBox="0 0 56 56" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M27.79 0c15.35 0 27.8 12.44 27.8 27.79 0 15.35-12.44 27.8-27.8 27.8S0 43.14 0 27.79C0 12.44 12.44 0 27.79 0zM19.96 30.86c.67 7.26 3.65 14.27 7.86 18.41 4.18-4.15 7.14-11.15 7.81-18.41H19.96zm-13.6 0c1.11 7.82 6.39 14.29 13.52 17.09-3.37-4.8-5.54-10.72-6.07-17.09h-7.46zm35.42 0c-.53 6.38-2.69 12.29-6.07 17.09 7.13-2.8 12.42-9.27 13.52-17.09h-7.46zM19.87 7.63c-7.13 2.8-12.4 9.28-13.52 17.1h7.46c.53-6.38 2.68-12.28 6.06-17.1zm7.88-1.32c-4.18 4.15-7.14 11.15-7.81 18.42h15.67c-.67-7.27-3.65-14.27-7.86-18.42zm7.96 1.32c3.38 4.82 5.54 12.28 6.07 17.1h7.45c-1.1-7.82-6.39-9.28-13.52-17.1z"/></svg>
                    Storage
                </button>
                <button class="settings-tab" data-tab="nodeStyle">
                    <svg width="16" height="16" viewBox="0 0 38 45" fill="currentColor"><path d="M18.56 44.5c-2.44 0-3.9-1.49-3.9-4.08V8.25c0-.56 0-.84-.11-1.05a.76.76 0 00-.44-.44c-.21-.11-.49-.11-1.05-.11H3.6c-2.14 0-3.6-1.28-3.6-3.32C0 1.28 1.43 0 3.6 0h29.95c2.16 0 3.6 1.28 3.6 3.32 0 2.04-1.47 3.32-3.6 3.32h-9.46c-.56 0-.84 0-1.05.11a.76.76 0 00-.44.44c-.11.21-.11.49-.11 1.05v32.17c0 2.59-1.47 4.08-3.93 4.08z"/></svg>
                    Node Style
                </button>
                <button class="settings-tab" data-tab="controls">
                    <svg width="16" height="16" viewBox="0 0 54 55" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.7.17c1.53-.4 3.03.16 4.07.49 1.22.39 2.75 1.03 4.51 1.77L46.24 16.02c1.51.63 2.85 1.19 3.87 1.73.9.48 2.08 1.2 2.85 2.43l.15.25.17.33c.79 1.66.84 3.59.12 5.29-.61 1.45-1.8 2.37-2.7 2.97-.78.64-2.06 1.33-3.5 2.11l-8.44 4.59c-.25.14-.38.21-.47.26-.05.1-.12.23-.26.48l-5.83 10.95c-.76 1.43-1.48 2.72-2.16 3.67-.51.91-1.41 2.1-2.86 2.72-1.8.78-3.85.7-5.61-.17-1.39-.74-2.18-2.03-2.7-2.98-.55-1-1.13-2.33-1.77-3.82L2.36 13.34C1.6 11.58.94 10.07.53 8.85c-.33-1.1-.73-2.74.23-4.37.63-2 2.21-3.57 4.2-4.21l.3-.07-.57-.03zm2.07 6.6c.3.88.81 2.08 1.63 3.95L22.94 44.18c.69 1.59 1.13 2.59 1.5 3.26.42-.65.93-1.7 1.75-3.24l5.84-10.95c.21-.4.5-.95.9-1.4l.24-.29c.25-.28.53-.54.82-.78.5-.4 1.05-.68 1.45-.86l8.45-4.58c1.54-.83 2.5-1.36 3.15-1.79-.69-.36-1.69-.79-3.36-1.48L10.75 8.33c-1.88-.77-2.99-1.23-3.82-1.51l-.06-.05z"/></svg>
                    Controls
                </button>
                <button class="settings-tab" data-tab="shortcuts">
                    <svg width="16" height="16" viewBox="0 0 51 51" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M40.4 0c3.4 0 5.11 0 6.4.66a6.28 6.28 0 012.66 2.66c.66 1.3.66 3 .66 6.4v30.68c0 3.4 0 5.11-.66 6.4a6.28 6.28 0 01-2.66 2.66c-1.3.66-3 .66-6.4.66H9.72c-3.4 0-5.1 0-6.4-.66a6.28 6.28 0 01-2.66-2.66C0 45.51 0 43.8 0 40.4V9.72c0-3.4 0-5.1.66-6.4A6.28 6.28 0 013.32.66C4.62 0 6.32 0 9.72 0h30.68zM9.72 6.28c-1.72 0-2.7 0-3.39.05-.05.7-.05 1.67-.05 3.4v30.67c0 1.73.01 2.7.05 3.4.7.05 1.67.05 3.4.05h30.67c1.73 0 2.7-.01 3.4-.05.04-.7.05-1.67.05-3.4V9.72c0-1.72-.01-2.7-.05-3.39-.7-.05-1.67-.05-3.4-.05H9.72z"/><path d="M23.03 37.26c-5.89 0-9.6-4.7-9.6-12.19 0-7.4 3.71-12.1 9.6-12.1 3.32 0 6.19 1.58 7.41 4.24h.06v-1.14c0-2.11 1.3-3.21 3.1-3.21 1.82 0 3.1 1.1 3.1 3.21v17.97c0 2.1-1.28 3.2-3.1 3.2-1.75 0-3.01-.95-3.09-2.92v-1.14h-.06c-1.2 2.7-4.07 4.2-7.42 4.2v-.12zm1.55-5.16c3.21 0 5.23-2.66 5.23-6.98 0-4.28-2.02-7.01-5.23-7.01-3.18 0-5.14 2.68-5.14 7.01 0 4.35 1.96 6.98 5.14 6.98z"/></svg>
                    Shortcuts
                </button>
            </div>
            <div class="settings-content">
                <!-- Storage Tab -->
                <div class="settings-panel active" data-panel="storage">
                    <div class="storage-cards">
                        <div class="storage-card active" id="browserStorageCard" data-storage="browser">
                            <div class="storage-card-icon">
                                <svg width="28" height="28" viewBox="0 0 56 56" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M27.79 0c15.35 0 27.8 12.44 27.8 27.79 0 15.35-12.44 27.8-27.8 27.8S0 43.14 0 27.79C0 12.44 12.44 0 27.79 0zM19.96 30.86c.67 7.26 3.65 14.27 7.86 18.41 4.18-4.15 7.14-11.15 7.81-18.41H19.96zm-13.6 0c1.11 7.82 6.39 14.29 13.52 17.09-3.37-4.8-5.54-10.72-6.07-17.09h-7.46zm35.42 0c-.53 6.38-2.69 12.29-6.07 17.09 7.13-2.8 12.42-9.27 13.52-17.09h-7.46zM19.87 7.63c-7.13 2.8-12.4 9.28-13.52 17.1h7.46c.53-6.38 2.68-12.28 6.06-17.1zm7.88-1.32c-4.18 4.15-7.14 11.15-7.81 18.42h15.67c-.67-7.27-3.65-14.27-7.86-18.42zm7.96 1.32c3.38 4.82 5.54 12.28 6.07 17.1h7.45c-1.1-7.82-6.39-9.28-13.52-17.1z"/></svg>
                            </div>
                            <div class="storage-card-content">
                                <div class="storage-card-title">Browser Storage</div>
                                <div class="storage-card-desc">Data stored in browser's local storage</div>
                            </div>
                        </div>
                        <div class="storage-card" id="fileStorageCard" data-storage="file">
                            <div class="storage-card-icon">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
                                </svg>
                            </div>
                            <div class="storage-card-content">
                                <div class="storage-card-title">File Storage</div>
                                <div class="storage-card-desc">Save files to your computer</div>
                                <div class="storage-card-badge disconnected" id="fileStorageBadge">Not Connected</div>
                            </div>
                        </div>
                    </div>

                    <div class="storage-info-note">
                        <svg width="16" height="16" viewBox="0 0 40 40" fill="currentColor"><path d="M19.6 15.87c1.52 0 2.53 1.06 2.53 2.7v10.18c0 1.64-1.01 2.7-2.53 2.7-1.52 0-2.53-1.06-2.53-2.7V18.57c0-1.64 1.01-2.7 2.53-2.7zM19.6 7.8c1.64 0 2.95 1.27 2.95 2.89 0 1.59-1.31 2.9-2.95 2.9-1.62 0-2.93-1.31-2.93-2.9 0-1.62 1.31-2.89 2.93-2.89z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M19.61 0c10.83 0 19.61 8.78 19.61 19.61s-8.78 19.61-19.61 19.61S0 30.44 0 19.61 8.78 0 19.61 0zm0 4.63c-8.27 0-14.98 6.71-14.98 14.98 0 8.27 6.71 14.98 14.98 14.98 8.27 0 14.98-6.71 14.98-14.98 0-8.27-6.71-14.98-14.98-14.98z"/></svg>
                        <p>File Storage requires Chrome, Edge, or Opera. Data is saved directly to your chosen folder, making it more reliable and portable.</p>
                    </div>

                    <div class="storage-export-section">
                        <h4>Export All Data</h4>
                        <p class="settings-description">Export all canvases as a single JSON file for backup.</p>
                        <button class="modal-btn modal-btn-submit" id="exportAllBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                            Export All Canvases
                        </button>
                    </div>
                </div>

                <!-- Node Style Tab -->
                <div class="settings-panel" data-panel="nodeStyle">
                    <div class="settings-section">
                        <h4>Default Font Size</h4>
                        <p class="settings-description">Set the default font size for new notes and memos.</p>
                        <div class="settings-option-group" id="defaultFontSize">
                            <button class="settings-option-btn active" data-value="small">Small</button>
                            <button class="settings-option-btn" data-value="medium">Medium</button>
                            <button class="settings-option-btn" data-value="large">Large</button>
                            <button class="settings-option-btn" data-value="xlarge">X-Large</button>
                        </div>
                        <div class="font-size-preview" id="fontSizePreview">
                            <span class="preview-label">Preview</span>
                            <div class="preview-text" id="previewText">The quick brown fox jumps over the lazy dog.</div>
                        </div>
                    </div>
                </div>

                <!-- Controls Tab -->
                <div class="settings-panel" data-panel="controls">
                    <div class="settings-section">
                        <h4>Wheel Zoom Direction</h4>
                        <p class="settings-description">Invert the zoom direction when using the mouse wheel.</p>
                        <div class="settings-toggle-row">
                            <span>Invert wheel zoom</span>
                            <label class="settings-toggle">
                                <input type="checkbox" id="invertWheelZoom">
                                <span class="settings-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>Grid Snap</h4>
                        <p class="settings-description">Snap nodes to the background grid when moving or resizing.</p>
                        <div class="settings-toggle-row">
                            <span>Enable grid snap</span>
                            <label class="settings-toggle">
                                <input type="checkbox" id="gridSnapToggle">
                                <span class="settings-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Shortcuts Tab -->
                <div class="settings-panel" data-panel="shortcuts">
                    <div class="settings-section shortcuts-section flex-grow">
                        <h4>Keyboard Shortcuts</h4>
                        <div class="shortcuts-list">
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Z</kbd></span>
                                <span class="shortcut-desc">Undo</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Y</kbd></span>
                                <span class="shortcut-desc">Redo</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>F</kbd></span>
                                <span class="shortcut-desc">Search nodes</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>S</kbd></span>
                                <span class="shortcut-desc">Save (auto-saved)</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Delete</kbd> / <kbd>Backspace</kbd></span>
                                <span class="shortcut-desc">Delete selected items</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Escape</kbd></span>
                                <span class="shortcut-desc">Deselect / Cancel action</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Space</kbd> + <kbd>Drag</kbd></span>
                                <span class="shortcut-desc">Pan canvas</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Middle Click</kbd> + <kbd>Drag</kbd></span>
                                <span class="shortcut-desc">Pan canvas</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Scroll Wheel</kbd></span>
                                <span class="shortcut-desc">Zoom in/out</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Double Click</kbd></span>
                                <span class="shortcut-desc">Create new node</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Shift</kbd> + <kbd>Click</kbd></span>
                                <span class="shortcut-desc">Add to selection</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Click</kbd> + <kbd>Drag</kbd> (on canvas)</span>
                                <span class="shortcut-desc">Box select</span>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-keys"><kbd>Right Click</kbd></span>
                                <span class="shortcut-desc">Context menu</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script type="module" src="./js/app.js"></script>
</body>
</html>
